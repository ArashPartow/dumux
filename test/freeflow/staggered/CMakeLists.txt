add_input_file_links()

add_executable(test_stokes_closedsystem EXCLUDE_FROM_ALL test_closedsystem.cc)

dune_add_test(NAME test_stokes_liddrivencavity
              TARGET test_stokes_closedsystem
              CMAKE_GUARD HAVE_UMFPACK
              COMMAND ${CMAKE_SOURCE_DIR}/bin/testing/runtest.py
              CMD_ARGS       --script fuzzy
                             --files ${CMAKE_SOURCE_DIR}/test/references/liddrivencavity-reference.vtu
                                     ${CMAKE_CURRENT_BINARY_DIR}/test_liddrivencavity-00002.vtu
                             --command "${CMAKE_CURRENT_BINARY_DIR}/test_stokes_closedsystem test_liddrivencavity.input")

dune_add_test(NAME test_stokes_hydrostaticpressure
              TARGET test_stokes_closedsystem
              CMAKE_GUARD HAVE_UMFPACK
              COMMAND ${CMAKE_SOURCE_DIR}/bin/testing/runtest.py
              CMD_ARGS       --script fuzzy
                             --files ${CMAKE_SOURCE_DIR}/test/references/stokeshydrostaticpressure-reference.vtu
                                     ${CMAKE_CURRENT_BINARY_DIR}/test_hydrostaticpressure-00002.vtu
                             --command "${CMAKE_CURRENT_BINARY_DIR}/test_stokes_closedsystem test_hydrostaticpressure.input"
                             --zeroThreshold {"velocity_Constant \(m/s\)":1e-16})

dune_add_test(NAME test_channel_stokes
              SOURCES test_channel.cc
              CMAKE_GUARD HAVE_UMFPACK
              COMMAND ${CMAKE_SOURCE_DIR}/bin/testing/runtest.py
              CMD_ARGS       --script fuzzy
                             --files ${CMAKE_SOURCE_DIR}/test/references/channel-stokes.vtu
                                     ${CMAKE_CURRENT_BINARY_DIR}/test_channel_stokes-00002.vtu
                             --command "${CMAKE_CURRENT_BINARY_DIR}/test_channel_stokes")

add_executable(test_channel_stokesni EXCLUDE_FROM_ALL test_channel.cc)
target_compile_definitions(test_channel_stokesni PUBLIC "NONISOTHERMAL=1")

dune_add_test(NAME test_channel_stokesni_convection
              TARGET test_channel_stokesni
              CMAKE_GUARD HAVE_UMFPACK
              COMMAND ${CMAKE_SOURCE_DIR}/bin/testing/runtest.py
              CMD_ARGS       --script fuzzy
                             --files ${CMAKE_SOURCE_DIR}/test/references/stokesni-convection-reference.vtu
                                     ${CMAKE_CURRENT_BINARY_DIR}/test_channel_stokesni_convection-00006.vtu
                             --command "${CMAKE_CURRENT_BINARY_DIR}/test_channel_stokesni test_channel_stokesni_convection.input")

dune_add_test(NAME test_channel_stokesni_conduction
              TARGET test_channel_stokesni
              CMAKE_GUARD HAVE_UMFPACK
              COMMAND ${CMAKE_SOURCE_DIR}/bin/testing/runtest.py
              CMD_ARGS       --script fuzzy
                             --files ${CMAKE_SOURCE_DIR}/test/references/stokesni-conduction-reference.vtu
                                     ${CMAKE_CURRENT_BINARY_DIR}/test_channel_stokesni_conduction-00004.vtu
                             --command "${CMAKE_CURRENT_BINARY_DIR}/test_channel_stokesni test_channel_stokesni_conduction.input"
                             --zeroThreshold {"velocity_H2O \(m/s\)":1e-20})

dune_add_test(NAME test_channel_navierstokes
              SOURCES test_channel.cc
              COMPILE_DEFINITIONS ENABLE_NAVIERSTOKES=1
              CMAKE_GUARD HAVE_UMFPACK
              COMMAND ${CMAKE_SOURCE_DIR}/bin/testing/runtest.py
              CMD_ARGS       --script fuzzy
                             --files ${CMAKE_SOURCE_DIR}/test/references/channel-navierstokes-reference.vtu
                                     ${CMAKE_CURRENT_BINARY_DIR}/test_channel_navierstokes-00002.vtu
                             --command "${CMAKE_CURRENT_BINARY_DIR}/test_channel_navierstokes")

dune_add_test(NAME test_stokes_donea
              SOURCES test_donea.cc
              CMAKE_GUARD HAVE_UMFPACK
              COMMAND ${CMAKE_SOURCE_DIR}/bin/testing/runtest.py
              CMD_ARGS       --script fuzzy
                             --files ${CMAKE_SOURCE_DIR}/test/references/stokes-donea-reference.vtu
                                     ${CMAKE_CURRENT_BINARY_DIR}/test_donea-00002.vtu
                             --command "${CMAKE_CURRENT_BINARY_DIR}/test_stokes_donea")

dune_add_test(NAME test_navierstokes_kovasznay
              SOURCES test_kovasznay.cc
              CMAKE_GUARD HAVE_UMFPACK
              COMMAND ${CMAKE_SOURCE_DIR}/bin/testing/runtest.py
              CMD_ARGS       --script fuzzy
                             --files ${CMAKE_SOURCE_DIR}/test/references/test_kovasznay-reference.vtu
                                     ${CMAKE_CURRENT_BINARY_DIR}/test_kovasznay-00001.vtu
                             --command "${CMAKE_CURRENT_BINARY_DIR}/test_navierstokes_kovasznay")

dune_add_test(NAME test_navierstokes_angeli
              SOURCES test_angeli.cc
              CMAKE_GUARD HAVE_UMFPACK
              COMMAND ${CMAKE_SOURCE_DIR}/bin/testing/runtest.py
              CMD_ARGS       --script fuzzy
                             --files ${CMAKE_SOURCE_DIR}/test/references/test_angeli-reference.vtu
                                     ${CMAKE_CURRENT_BINARY_DIR}/test_angeli-00045.vtu
                             --command "${CMAKE_CURRENT_BINARY_DIR}/test_navierstokes_angeli")
