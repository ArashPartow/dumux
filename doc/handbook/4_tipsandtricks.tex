\section{Tips \& Tricks}

This chapter tries to be a useful collection of tips and tricks that can be handy
when working with \Dumux. One of the most prominent ideas for developing
\Dune / \Dumux is that reinventing the wheel in terms of FEM code should
be avoided. We try to follow this idea also in the day-to-day work by
stating the \emph{tell us dogma}: ``If you found something useful, 
handy or for other reasons helping when working with \Dumux: put it into
this chapter.'' or inform other developers and write to 

\subsection{\Dumux - General Remarks}

\paragraph{Flyspray}
Flyspray or bug-tracking system is a software application mainly designed to
keep track of reported software development requests. This includes reported
bugs and development requests for new or improved features. The main benefit
of a bug-tracking system is to provide a clear centralized overview of all
recorded requests and their state. \Dumux users and developers can submit
development requests at \url{http://www.dumux.org/flyspray/}.

\paragraph{Dashboard}
The testing-dashboard is a tool to constantly check the \Dumux problems for compiling
or running correctly. It is a useful tool to check the impacts of your commits
and for quality management. The dashboard is available at 
\url{http://www.dumux.org/dashboard.php}.

\paragraph{The \Dumux Mailing List:}
If you have questions concerning \Dumux, hints for the \Dumux-developers
or specific problems, which you really struggle to solve on your own,
you can contact the mailing list \url{dumux@iws.uni-stuttgart.de}.
You can also subscribed to the mailing list via
\url{https://listserv.uni-stuttgart.de/mailman/listinfo/dumux}, then you
will be informed about upcoming releases or events.

\paragraph{The Commit Mailing List:}
If you further want to be informed about commits to the dumux can subscribe
to the commit mailing list:
\url{https://listserv.uni-stuttgart.de/mailman/listinfo/dumux-commits}.

\subsection{Developing \Dumux}
\paragraph{Checking Your Commits:}
\Dumux is developed with the help of Subversion (\texttt{svn}).
This means that at some point you will commit your new and/or advanced features
to the repository. In the following some additional guidelines are shown which are 
are good practice. Especially if you plan on committing to the stable part of
\Dumux you must follow these steps.
\begin{itemize}
  \item add files and folders to your repository
  \item run \texttt{make doc} in your build-directory
  \item run \texttt{make headercheck} in your build-directory
  \item run \texttt{ctest} in your build-directory
  \item double-check whether the test are working. \textbf{If not} please
        investigate whether an update of the reference solution or a review
        of your changes is necessary
  \item double-check whether you include all necessary files to your commit
  \item commit
  \item check-out dumux in new folder and test if everything is still working
        (this is necessary to keep bump in the workflow small).
  \item check the testing-dashboard (see above), whether everything is still working
\end{itemize}

\paragraph{Naming conventions} 
General guidelines for naming conventions are specified in Section \ref{guidelines}.
However, in order to avoid ambiguity a list of proposed names for variables, types,
functions etc is provided where users and mainly \Dumux developers can refer for
standards (check \texttt{dumux-devel/\allowbreak doc/\allowbreak naminglist/\allowbreak naming-conventions.odt}).

\paragraph{Errors Messages Related to the Property System}
The property system is a powerful tool and internally does some template and macro magic. 
The price for it are sometimes unintuitive compiler error messages. For example if the
definition of a property could not be found, the error is:
\begin{lstlisting}[style=DumuxCode,numbers=none]
error: no type named 'p' in 'struct Dumux::Properties::GetProperty<Dumux::Properties::TTag::TestProblem, Dumux::Properties::PTag::Scalar, Dumux::Properties::TTag::TestProblem, -1000>'
\end{lstlisting}

\noindent So check whether you did not misspelled any name related to the property system in the 
line of the error message and whether you really declared the type tag you use there.\\
Further check, if the \texttt{Problem} property was defined and spelled correctly.

\paragraph{Patching Files or Modules}
See \ref{sc:patchingDUNE} if you need to apply patches to \Dumux or \Dune.
If you want to send changes to an other developer of \Dumux providing patches
can be quite smart. To create a patch simply type:
\begin{lstlisting}[style=Bash]
$ svn diff > PATCHFILE
\end{lstlisting}
\noindent which creates a text file containing all your changes to the files
in the current folder or its subdirectories.
Other developers can now simply apply this patch by 
\begin{lstlisting}[style=Bash]
$ path -p0 < PATCHFILE
\end{lstlisting}

\paragraph{Using \Dune Debug Streams}
\Dune provides a helpful feature, for keeping your debug-output organized. 
  In stead of juggling with a bazillion \texttt{std::cout <<} statements or keeping some debug-precompiler statements organized, which are generally and strongly discouraged see \ref{guidelines} in order not to get 
  flooded away by your output \Dune gives you a nice tool by the so called debug streams. 

  These are streams like \texttt{cout} but they can be switched on and off for the whole project. 
  Maybe if you are really in the  dark you want to see all your debug information. Another time you may only want to be warned if something is going seriously wrong during a simulation. 
  This can be achieved by setting the debug streams to desired values. There are five levels:
\begin{verbatim}
5 - grave (dgrave)
4 - warning (dwarn)
3 - info (dinfo)
2 - verbose (dverb)
1 - very verbose (dvverb)
\end{verbatim}

They are used as follows: \lstinline{Dune::dinfo << "message";} or \lstinline{Dune::dgrave  << "message";} .
The debug streams are switched on/off via  setting \lstinline{#define DUNE_MINIMAL_DEBUG_LEVEL 4}
in the source your application. If the value is set to e.\,g. 4 only the output generated after
\lstinline{Dune::dwarn} and \lstinline{Dune::dgrave} will be printed.


\paragraph{File Name and Line Number by Predefined Macro}
If you want to  know where some output or debug information came from, you can use the predefined macros \lstinline{__FILE__} and \lstinline{__LINE__}
which are used like\\
\lstinline{dataFile << "# This was written from "<< __FILE__ << ", line " << __LINE__ << "\n";}\\
which translates into a line in the output file reading\\
\lstinline{# This was written from [..]/dumux/dumux/io/outputToFile.hh, line 261}\\
This can also be very useful, if you want to have information about where some warning or debug information was issued. 

\paragraph{Option Files optim.opts and debug.opts}
\Dune and \Dumux are built with the help of \texttt{dunecontrol}, as explained on page \pageref{buildIt}.
A lot of options need to be specified for that, which is done in option files. \Dumux provides two example files
\texttt{debug.opts} and \texttt{optim.opts}. These two files differ in the way \Dune and \Dumux are compiled:
either for debugging or for fast simulation. Switching between these two states can lead to a speedup of factor up to ten!
Programs that are compiled with optimization can hardly be debugged because the debugger gets confused.
Debugging with the optimization options active will lead to erratic behavior while debugging. 

You can modify the files and add third-party dependencies or additional compiler flags.

\paragraph{Dunecontrol for selected modules}
A complete build using \texttt{dunecontrol} takes some time. In many cases not all modules need to be re-built.
Pass the flag \texttt{--only=dumux} to \texttt{dunecontrol} for configuring or building only \Dumux. A more
complex example would be the use of an additional grid. Then you have to configure and build only \Dune{}-grid
and \Dumux by adding \texttt{--only=dune-grid,dumux} to the \texttt{dunecontrol} call.

\subsection{External Tools}
\subsubsection{Subversion (svn)}

Subversion is a software versioning and revision control system. We use Subversion to manage the source code
of \Dumux, archive changes and central storage.

\paragraph{Basic Commands}
The basic svn commands are:
\begin{itemize}
  \item \texttt{svn checkout} checkout a repository
  \item \texttt{svn update} updates file/folder
  \item \texttt{svn status} to check which files/folders have been changed
        \texttt{M}odified, \texttt{D}eleted, \texttt{A}dded, \texttt{?} not in repository
  \item \texttt{svn diff} to see the actual changes of a file/folder
  \item \texttt{svn commit} upload changes to the repository (only with meaningful
        commit messages)
\end{itemize}
The above shows you the necessary steps if you use the command line. There are also other tools providing a graphical 
user interface for using svn like kdesvn or eclipse.

\paragraph{Properties/Attributes}
How to set the SVN attributes:
\begin{itemize}
 \item{\em eclipse}: right click on the file/folder $\rightarrow$ ``team''
        $\rightarrow$ ``add to svn:ignore\dots''
 \item{\em kdesvn}: right click on the file/folder $\rightarrow$ ``ignore/unignore
        current item''
 \item{\em SVN on shell}: \verb+svn propedit svn:ignore .+
\end{itemize}

\subsubsection{Git}
Git plays a similar role as Subversion, some see Git as a successor of Subversion. Git is used by \Dune. The basic
Git commands are:
\begin{itemize}
  \item \texttt{git clone} clone a repository (similar to svn checkout)
  \item \texttt{git pull} pull changes from the repository (similar to svn update)
  \item \texttt{git status} to check which files/folders have been changed
  \item \texttt{git diff} to see the actual changes of a file/folder
\end{itemize}

\subsubsection{Eclipse}
\paragraph{Using the \Dumux-Eclipse Profile}
Everybody using the same profile has the advantage of resulting in less conflicts
when different developing environments are used:
\begin{enumerate}
  \item in eclipse open: \texttt{Window} $\rightarrow$ \texttt{Preferences} $\rightarrow$ \texttt{C/C++}  $\rightarrow$ \texttt{Code Style} $\rightarrow$ Formatter
  \item press the \texttt{Import} button
  \item choose the file \texttt{eclipse\_profile.xml} from your dumux-devel directory
  \item make sure that that now \Dumux is chosen in \texttt{Select a profile}
\end{enumerate}

% \subsection{kate}

\subsubsection{ParaView}
\paragraph{Reload Button:}
Yes, you read it right. There is script to reload \texttt{pvd} files or
series of \texttt{vtu} files since ParaView 4.2. The scripts are available
under the links below. Just save the specific code portion in a file and load
it via \texttt{Macros} $\rightarrow$ \texttt{Add new macro}.\\
\texttt{vtk}: \url{http://markmail.org/message/exxynsgishbvtngg#query:+page:1+mid:rxlwxs7uqrfgibyv+state:results}\\
\texttt{pvd}: \url{http://markmail.org/message/exxynsgishbvtngg#query:+page:1+mid:rxlwxs7uqrfgibyv+state:results}.

\paragraph{Guide:}
Since ParaView 4.3.1 The ParaView Guide is partly
available for free download, see \url{http://www.paraview.org/documentation/}.
It corresponds to the ParaView book, only without three application chaptes.
Attention its size is 180 MiB.
